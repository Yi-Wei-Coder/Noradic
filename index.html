<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 åŒ—æ­æ¥µå…‰è¡Œ (Nordic 2025)</title>
    <style>
        :root {
            --primary: #004e66;
            --secondary: #e0f7fa;
            --accent: #ff6f61;
            --bg: #f8f9fa;
            --text: #2c3e50;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-bottom: 80px;
        }
        header {
            background: linear-gradient(135deg, #004e66 0%, #002a3a 100%);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        h1 { margin: 0 0 10px 0; font-size: 1.4rem; text-align: center; }
        
        /* æœå°‹èˆ‡æ§åˆ¶å€ */
        .controls {
            display: flex;
            gap: 10px;
        }
        .search-box {
            flex: 1;
            position: relative;
        }
        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 35px;
            border-radius: 20px;
            border: none;
            background: rgba(255,255,255,0.95);
            font-size: 15px;
            box-sizing: border-box;
        }
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .container { max-width: 800px; margin: 15px auto; padding: 0 10px; }

        .day-card {
            background: white;
            border-radius: 16px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .day-header {
            padding: 12px 15px;
            background: #fff;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .day-info h2 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        .day-loc { font-size: 0.85rem; color: #666; margin-top: 4px; display: flex; align-items: center; gap: 8px; }
        
        /* å¤©æ°£èˆ‡æ¥µå…‰ Badge */
        .weather-badge {
            font-size: 0.75rem;
            background: #e3f2fd;
            color: #1565c0;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
        }
        .aurora-badge {
            font-size: 0.75rem;
            background: linear-gradient(45deg, #1a237e, #4a148c);
            color: #a7ffeb;
            padding: 3px 8px;
            border-radius: 12px;
            display: none; /* é è¨­éš±è—ï¼Œåªåœ¨é«˜ç·¯åº¦é¡¯ç¤º */
            align-items: center;
            margin-left: 5px;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow { from { text-shadow: 0 0 2px #a7ffeb; } to { text-shadow: 0 0 8px #a7ffeb; } }

        .day-content { padding: 5px 15px 15px; display: block; }

        .item {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            position: relative;
        }
        .item::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 28px;
            bottom: -20px;
            width: 2px;
            background: #f0f0f0;
            z-index: 0;
        }
        .item:last-child::before { display: none; }

        .time-col { min-width: 45px; text-align: right; z-index: 1; }
        .time { font-size: 0.9rem; font-weight: 700; color: var(--text); background: white; }
        .duration { font-size: 0.65rem; color: #999; display: block; margin-top: 2px; }

        .details-col {
            flex: 1;
            background: #fafafa;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #eee;
        }
        .name-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .name { font-weight: 600; font-size: 1rem; color: var(--primary); }
        
        .status-dot {
            height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 4px;
        }
        .status-open { background-color: var(--success); box-shadow: 0 0 4px var(--success); }
        .status-closed { background-color: var(--danger); }
        .status-closing { background-color: var(--warning); }
        .status-text { font-size: 0.7rem; color: #666; font-weight: normal; }

        .tags { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 5px; }
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; color: white; }
        .tag.transport { background-color: #7986cb; }
        .tag.food { background-color: #ef5350; }
        .tag.spot { background-color: #66bb6a; }
        .tag.hotel { background-color: #78909c; }
        .tag.ai { background: linear-gradient(45deg, #ab47bc, #8e24aa); }

        .note { font-size: 0.85rem; color: #555; margin-top: 5px; line-height: 1.4; }
        .hours-info { font-size: 0.75rem; color: #888; margin-top: 3px; display: block; }

        a { text-decoration: none; color: inherit; }
    </style>
</head>
<body>

<header>
    <h1>2025 åŒ—æ­æ¥µå…‰ä¹‹æ—…</h1>
    <div class="controls">
        <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input type="text" id="searchInput" placeholder="æœå°‹è¡Œç¨‹..." onkeyup="filterItinerary()">
        </div>
    </div>
</header>

<div class="container" id="itinerary-container"></div>

<script>
    // åŸå¸‚åº§æ¨™ (ç”¨æ–¼å¤©æ°£èˆ‡æ¥µå…‰)
    const LOCS = {
        "Oslo": { lat: 59.91, lon: 10.75 },
        "FlÃ¥m": { lat: 60.86, lon: 7.11 },
        "Bergen": { lat: 60.39, lon: 5.32 },
        "Helsinki": { lat: 60.16, lon: 24.93 },
        "Rovaniemi": { lat: 66.50, lon: 25.72 }, // æ¥µå…‰åœˆ
        "PyhÃ¤": { lat: 67.02, lon: 27.24 }, // æ¥µå…‰åœˆ
        "Tallinn": { lat: 59.43, lon: 24.75 },
        "Copenhagen": { lat: 55.67, lon: 12.56 }
    };

    // è¡Œç¨‹è³‡æ–™ (Updated Hours for Winter 2025)
    // æ ¼å¼: open_w (weekday), open_s (saturday), open_u (sunday)
    const data = [
        {
            date: "11/29", day: "Sat", loc: "Oslo",
            items: [
                { type: "transport", time: "07:05", name: "æŠµé”å¥§æ–¯é™¸ (TG594)", note: "æ©Ÿå ´å¿«ç·š Flytoget", duration: "1hr" },
                { type: "food", time: "12:00", name: "Fiskeriet Youngstorget", note: "å¿…åƒé­šæ¹¯", hours: "12:00-22:00", openRule: {s: [12,22]} },
                { type: "spot", time: "14:00", name: "å¥§æ–¯é™¸æ­ŒåŠ‡é™¢", note: "å±‹é ‚çœ‹é¢¨æ™¯ (å…è²»)", hours: "Always Open", openRule: "24h" },
                { type: "spot", time: "15:30", name: "Munch Museum", note: "é€±å…­é–‹åˆ°å¾ˆæ™š", hours: "10:00-21:00", openRule: {s: [10,21]} },
                { type: "food", time: "18:00", name: "Engebret Cafe", note: "é€±å…­ 17:00 æ‰é–‹", hours: "17:00-23:00", openRule: {s: [17,23]} }
            ]
        },
        {
            date: "11/30", day: "Sun", loc: "FlÃ¥m",
            items: [
                { type: "transport", time: "08:25", name: "ç«è»Š Oslo -> Myrdal", note: "æŒªå¨ç¸®å½±", duration: "4.5hr" },
                { type: "transport", time: "13:15", name: "é«˜å±±ç«è»Š -> FlÃ¥m", note: "å³å´é¢¨æ™¯", duration: "1hr" },
                { type: "spot", time: "15:00", name: "Stegastein è§€æ™¯å°", note: "æ—¥è½æ—©ï¼Œå»ºè­°æ—©é»å»", hours: "24h (Toilet Closed)", openRule: "24h" },
                { type: "food", time: "18:00", name: "Ã†gir BrewPub", note: "ç¶­äº¬ç²¾é‡€", hours: "12:00-22:00", openRule: {u: [12,22]} }
            ]
        },
        {
            date: "12/01", day: "Mon", loc: "Bergen",
            items: [
                { type: "transport", time: "13:51", name: "ç«è»Š -> Bergen", note: "æŠµé” 14:59", duration: "1hr" },
                { type: "spot", time: "15:30", name: "Bryggen å¸ƒå‘‚æ ¹", note: "ä¸–ç•Œéºç”¢", hours: "Open Area", openRule: "24h" },
                { type: "spot", time: "16:30", name: "FlÃ¸ibanen çºœè»Š", note: "çºœè»Šé–‹åˆ°å¾ˆæ™š", hours: "07:30-24:00", openRule: {w: [7.5, 24]} },
                { type: "food", time: "19:00", name: "Trekroneren", note: "é¦´é¹¿ç†±ç‹—", hours: "11:00-03:00", openRule: {w: [11, 27]} }
            ]
        },
        {
            date: "12/02", day: "Tue", loc: "Helsinki",
            items: [
                { type: "transport", time: "09:20", name: "é£›æ©Ÿ -> Helsinki", note: "AY922", duration: "" },
                { type: "spot", time: "15:00", name: "å²©çŸ³æ•™å ‚", note: "Temppeliaukio", hours: "10:00-16:50", openRule: {w: [10, 16.8]} },
                { type: "spot", time: "17:30", name: "Oodi ä¸­å¤®åœ–æ›¸é¤¨", note: "çµ•ç¾å»ºç¯‰", hours: "08:00-21:00", openRule: {w: [8, 21]} },
                { type: "food", time: "18:30", name: "Robert's Coffee", note: "è—è“æ´¾", hours: "07:30-20:00", openRule: {w: [7.5, 20]} },
                { type: "transport", time: "19:29", name: "è‡¥é‹ªç«è»Š -> Rovaniemi", note: "VR Night Train", duration: "12hr" }
            ]
        },
        {
            date: "12/03", day: "Wed", loc: "Rovaniemi",
            items: [
                { type: "spot", time: "08:30", name: "è–èª•è€äººæ‘", note: "Santa Claus Village", hours: "08:00-20:00", openRule: {w: [8, 20]} },
                { type: "spot", time: "13:00", name: "Arktikum æ¥µåœ°åšç‰©é¤¨", note: "ç»ç’ƒé•·å»Š", hours: "10:00-18:00", openRule: {w: [10, 18]} },
                { type: "hotel", time: "Night", name: "Northern Lights Village", note: "æ¥µå…‰è§€æ¸¬", hours: "24h", openRule: "24h" }
            ]
        },
        {
            date: "12/06", day: "Sat", loc: "Tallinn",
            items: [
                { type: "spot", time: "12:00", name: "å¡”æ—è€åŸå€", note: "Old Town", hours: "24h", openRule: "24h" },
                { type: "spot", time: "16:00", name: "è–èª•å¸‚é›† (å¸‚æ”¿å»³)", note: "11/22-12/27", hours: "10:00-20:00", openRule: {s: [10, 20]} }
            ]
        },
        {
            date: "12/07", day: "Sun", loc: "Copenhagen",
            items: [
                { type: "spot", time: "18:30", name: "Tivoli Gardens", note: "è–èª•å­£", hours: "11:00-22:00", openRule: {u: [11, 22]} }
            ]
        },
        {
            date: "12/08", day: "Mon", loc: "Copenhagen",
            items: [
                { type: "spot", time: "09:00", name: "Kronborg åŸå ¡", note: "èµ«çˆ¾è¾›æ ¼", hours: "10:00-16:00 (Mon Closed usually, check!)", openRule: {w: [10, 16]} },
                { type: "spot", time: "16:00", name: "Nyhavn æ–°æ¸¯", note: "é‹æ²³", hours: "24h", openRule: "24h" }
            ]
        }
    ];

    const container = document.getElementById('itinerary-container');

    async function render() {
        container.innerHTML = '';
        const now = new Date();
        const currentDay = now.getDay(); // 0=Sun, 6=Sat
        const currentHour = now.getHours() + now.getMinutes()/60;

        for (let i = 0; i < data.length; i++) {
            const day = data[i];
            const coords = LOCS[day.loc.split('->')[0].trim()] || LOCS["Oslo"];
            
            // å¤©æ°£èˆ‡æ¥µå…‰ ID
            const wId = `w-${i}`;
            const aId = `a-${i}`;

            let itemsHtml = '';
            day.items.forEach(item => {
                // é–‹é–€ç‹€æ…‹æª¢æŸ¥
                let statusHtml = '';
                if (item.openRule) {
                    const status = checkOpenStatus(item.openRule, currentDay, currentHour);
                    if (status) {
                        statusHtml = `<span class="status-text">${status}</span>`;
                    }
                }

                // Google Map
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.name + " " + day.loc)}`;
                
                itemsHtml += `
                <a href="${mapLink}" target="_blank">
                    <div class="item">
                        <div class="time-col">
                            <div class="time">${item.time}</div>
                            <span class="duration">${item.duration || ''}</span>
                        </div>
                        <div class="details-col">
                            <div class="name-row">
                                <span class="name">${item.name}</span>
                                ${statusHtml}
                            </div>
                            <div class="tags">
                                <span class="tag ${item.type}">${getTypeLabel(item.type)}</span>
                            </div>
                            <div class="note">${item.note}</div>
                            <span class="hours-info">ğŸ•’ å†¬å­£æ™‚é–“: ${item.hours}</span>
                        </div>
                    </div>
                </a>`;
            });

            // å»ºç«‹å¡ç‰‡
            const card = document.createElement('div');
            card.className = 'day-card';
            card.innerHTML = `
                <div class="day-header" onclick="toggleDay(${i})">
                    <div class="day-info">
                        <h2>${day.date} (${day.day})</h2>
                        <div class="day-loc">
                            ğŸ“ ${day.loc}
                            <span id="${wId}" class="weather-badge">è¼‰å…¥ä¸­...</span>
                            <span id="${aId}" class="aurora-badge" onclick="window.open('https://www.swpc.noaa.gov/products/aurora-30-minute-forecast', '_blank'); event.stopPropagation();">âœ¨ æ¥µå…‰é æ¸¬</span>
                        </div>
                    </div>
                    <div style="color:#ccc">â–¼</div>
                </div>
                <div class="day-content" id="day-${i}" style="display:${i===0?'block':'none'}">
                    ${itemsHtml}
                </div>
            `;
            container.appendChild(card);

            // éåŒæ­¥è¼‰å…¥å¤©æ°£
            fetchWeather(coords.lat, coords.lon, wId, aId);
        }
    }

    // åˆ¤æ–·é–‹é–€ç‹€æ…‹ (é‡å°ä½¿ç”¨è€…ç•¶ä¸‹è§€çœ‹ç¶²é çš„æ™‚é–“)
    function checkOpenStatus(rule, day, nowHour) {
        if (rule === '24h') return '<span class="status-dot status-open"></span> 24h é–‹æ”¾';
        
        // ç°¡å–®å°æ‡‰: w=å¹³æ—¥, s=é€±å…­, u=é€±æ—¥
        let range = null;
        if (day >= 1 && day <= 5) range = rule.w || rule.s; // è‹¥æ²’å¹³æ—¥è³‡æ–™ç”¨é€±å…­æ“‹ä¸€ä¸‹
        else if (day === 6) range = rule.s || rule.w;
        else if (day === 0) range = rule.u || rule.s;

        if (!range) return ''; // ç„¡è³‡æ–™

        const [open, close] = range;
        // è·¨å¤œè™•ç† (e.g., 11:00 - 03:00 -> 11, 27)
        
        if (nowHour >= open && nowHour < close) {
            // å¿«æ‰“çƒŠäº† (å‰©1å°æ™‚)
            if (close - nowHour < 1) return '<span class="status-dot status-closing"></span> å¿«æ‰“çƒŠ';
            return '<span class="status-dot status-open"></span> ç‡Ÿæ¥­ä¸­';
        } else {
            return '<span class="status-dot status-closed"></span> ä¼‘æ¯ä¸­';
        }
    }

    // æŠ“å–å¤©æ°£ + é›²é‡ (åˆ¤æ–·æ¥µå…‰)
    async function fetchWeather(lat, lon, wId, aId) {
        try {
            // ä½¿ç”¨ Open-Meteo
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=cloudcover&forecast_days=1`;
            const res = await fetch(url);
            const data = await res.json();
            
            // 1. é¡¯ç¤ºå¤©æ°£
            const temp = data.current_weather.temperature;
            const code = data.current_weather.weathercode;
            const icon = getWeatherIcon(code);
            document.getElementById(wId).innerHTML = `${icon} ${temp}Â°C`;

            // 2. åˆ¤æ–·æ¥µå…‰ (ç·¯åº¦ > 60 ä¸” æ™šä¸Š ä¸” é›²å°‘)
            if (lat > 60) {
                const hourIndex = new Date().getHours();
                const cloudCover = data.hourly.cloudcover[hourIndex] || 0;
                const isNight = data.current_weather.is_day === 0;

                const auroraElem = document.getElementById(aId);
                // åªæœ‰åœ¨åŒ—æ–¹åŸå¸‚é¡¯ç¤º
                if (lat > 64) auroraElem.style.display = 'inline-flex'; 

                if (isNight && cloudCover < 40) {
                    auroraElem.innerHTML = "âœ¨ æ¥µå…‰æ©Ÿç‡: é«˜ (é›²å°‘)";
                    auroraElem.style.background = "linear-gradient(45deg, #43a047, #1b5e20)";
                } else if (isNight && cloudCover < 80) {
                    auroraElem.innerHTML = "â˜ï¸ æ¥µå…‰æ©Ÿç‡: ä¸­ (å¤šé›²)";
                } else if (isNight) {
                    auroraElem.innerHTML = "ğŸŒ«ï¸ æ¥µå…‰æ©Ÿç‡: ä½ (é›²åš)";
                    auroraElem.style.background = "#78909c";
                } else {
                    auroraElem.innerHTML = "â˜€ï¸ ç™½å¤© (ç„¡æ¥µå…‰)";
                    auroraElem.style.display = 'none';
                }
            }
        } catch(e) { console.log(e); }
    }

    function getWeatherIcon(code) {
        if (code === 0) return 'â˜€ï¸';
        if (code < 3) return 'â›…';
        if (code < 50) return 'ğŸŒ«ï¸';
        if (code < 70) return 'ğŸŒ§ï¸';
        return 'â„ï¸';
    }

    function getTypeLabel(type) {
        return { 'transport': 'äº¤é€š', 'food': 'ç¾é£Ÿ', 'spot': 'æ™¯é»', 'hotel': 'ä½å®¿' }[type] || type;
    }
    
    function toggleDay(i) {
        const el = document.getElementById(`day-${i}`);
        el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }

    function filterItinerary() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        document.querySelectorAll('.day-card').forEach(card => {
            const match = card.innerText.toLowerCase().includes(val);
            card.style.display = match ? 'block' : 'none';
        });
    }

    render();
</script>

</body>
</html>
